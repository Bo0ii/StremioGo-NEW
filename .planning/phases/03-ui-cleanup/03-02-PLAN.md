---
phase: 03-ui-cleanup
plan: 02
type: execute
depends_on: ["03-01"]
files_modified: [src/components/plus-page/plusPage.ts]
---

<objective>
Remove native player logic from plusPage.ts TypeScript file.

Purpose: Eliminate getNativePlayerContent() function (180 lines), setupNativePlayerControls() function (92 lines), and category registration to complete Plus Page cleanup.
Output: plusPage.ts with all MPV integration logic removed, other categories functional.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ui-cleanup/03-01-SUMMARY.md
@src/components/plus-page/plusPage.ts

**Prior work:**
Plan 03-01 removed the native player sidebar item from HTML template. Now removing the TypeScript logic that powered that UI.

**Integration points in plusPage.ts:**
1. Line 20: `nativeplayer: getNativePlayerContent,` in categoryContent object
2. Lines 322-324: `case 'nativeplayer': setupNativePlayerControls(); break;` in switch statement
3. Lines 1168-1348: `function getNativePlayerContent(): string` (180 lines)
4. Lines 1350-1442: `function setupNativePlayerControls(): void` (92 lines)

**Total removal:** ~276 lines across 4 locations

**Established patterns:**
- Category content generators are functions returning HTML strings
- Category setup functions bind event handlers to controls
- categoryContent object maps category names to generator functions
- Switch statement in category activation calls setup functions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove nativeplayer from categoryContent object</name>
  <files>src/components/plus-page/plusPage.ts</files>
  <action>
Delete line 20 in src/components/plus-page/plusPage.ts:
```typescript
nativeplayer: getNativePlayerContent,
```

This is in the categoryContent object (lines 15-22). After deletion, the object should contain 5 entries: themes, plugins, tweaks, appearance, about.

WHY: With getNativePlayerContent function being removed in Task 3, this reference will become a dead reference causing TypeScript compilation errors. Remove now to maintain clean object definition.
  </action>
  <verify>
grep -n "nativeplayer:" src/components/plus-page/plusPage.ts returns no matches in the categoryContent object.
The categoryContent object has 5 entries (was 6).
  </verify>
  <done>
- Line 20 deleted from plusPage.ts
- categoryContent object has 5 entries
- No references to getNativePlayerContent in object
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove nativeplayer case from switch statement</name>
  <files>src/components/plus-page/plusPage.ts</files>
  <action>
Delete lines 322-324 in src/components/plus-page/plusPage.ts:
```typescript
case 'nativeplayer':
	setupNativePlayerControls();
	break;
```

This is in the category activation switch statement. After deletion, the switch should handle 5 categories: themes, plugins, tweaks, appearance, about.

WHY: With setupNativePlayerControls function being removed in Task 4, this case will reference a non-existent function. Remove to prevent compilation errors and ensure switch handles only valid categories.
  </action>
  <verify>
grep -n "case 'nativeplayer'" src/components/plus-page/plusPage.ts returns no matches.
grep -n "setupNativePlayerControls" src/components/plus-page/plusPage.ts returns no matches (except in function definition which will be removed next).
  </verify>
  <done>
- Lines 322-324 deleted from plusPage.ts
- Switch statement handles 5 categories
- No calls to setupNativePlayerControls in switch
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove getNativePlayerContent function</name>
  <files>src/components/plus-page/plusPage.ts</files>
  <action>
Delete lines 1167-1348 in src/components/plus-page/plusPage.ts (complete function including comment separator):

```typescript
// ==================== NATIVE PLAYER ====================
function getNativePlayerContent(): string {
	const enabled = localStorage.getItem(STORAGE_KEYS.NATIVE_PLAYER_ENABLED) === 'true';
	const videoOutput = localStorage.getItem(STORAGE_KEYS.NATIVE_PLAYER_VIDEO_OUTPUT) || 'gpu-next';
	... [180 lines total]
	`;
}
```

Delete from the comment line (1167) through the closing brace of the function (1348). This is a 181-line block (including section separator comment).

WHY: This function generates the native player settings UI using localStorage keys and STORAGE_KEYS constants that reference deleted MPV configuration. With core MPV files deleted, this UI is non-functional. DO NOT remove the `// ==================== UTILITY FUNCTIONS ====================` separator that follows this function.
  </action>
  <verify>
grep -n "getNativePlayerContent" src/components/plus-page/plusPage.ts returns no matches.
grep -n "NATIVE PLAYER ==" src/components/plus-page/plusPage.ts returns no matches.
The line after deletion should be the setupNativePlayerControls function or UTILITY FUNCTIONS separator.
  </verify>
  <done>
- Lines 1167-1348 deleted from plusPage.ts (~181 lines)
- No getNativePlayerContent function definition
- No "NATIVE PLAYER" section separator
- File structure intact (utility functions section follows)
  </done>
</task>

<task type="auto">
  <name>Task 4: Remove setupNativePlayerControls function</name>
  <files>src/components/plus-page/plusPage.ts</files>
  <action>
Delete lines 1350-1442 in src/components/plus-page/plusPage.ts (complete function):

```typescript
function setupNativePlayerControls(): void {
	const { ipcRenderer } = require('electron');
	... [92 lines total including all event listeners]
}
```

Delete from the function declaration (line 1350) through the closing brace (line 1442). This is a 93-line block.

CRITICAL: After this deletion, verify the next line is the `// ==================== UTILITY FUNCTIONS ====================` separator (or similar section marker). DO NOT delete utility functions that follow.

WHY: This function sets up event handlers for native player controls using IPC channels (native-player-set-upscaler, open-native-player-config-folder) that no longer exist after Phase 2 core file removal. Event handlers reference STORAGE_KEYS constants that will be removed in Phase 4.
  </action>
  <verify>
grep -n "setupNativePlayerControls" src/components/plus-page/plusPage.ts returns no matches.
grep -n "native-player-set-upscaler\|open-native-player-config-folder" src/components/plus-page/plusPage.ts returns no matches.
The line after deletion should be a section separator or utility function.
  </verify>
  <done>
- Lines 1350-1442 deleted from plusPage.ts (~93 lines)
- No setupNativePlayerControls function definition
- No IPC calls to native-player-* channels in plusPage.ts
- Next section (utility functions) intact
  </done>
</task>

<task type="auto">
  <name>Task 5: Verify TypeScript compilation</name>
  <files>src/components/plus-page/plusPage.ts</files>
  <action>
Run TypeScript compilation to ensure no errors introduced:

```bash
npm run dist
```

This compiles all TypeScript files including plusPage.ts. Expected result: Compilation succeeds with 0 errors.

If compilation errors occur, they will likely be:
- Unused imports (unlikely - we didn't remove imports)
- Syntax errors from deletion (missing braces, etc.)
- References to removed functions (should have been caught in prior tasks)

TypeScript strict mode is enabled with noUnusedLocals, noUnusedParameters, noImplicitReturns - compilation will fail if we introduced issues.

WHY: Verify that ~276 lines of deletion didn't introduce syntax errors or break the Plus Page module.
  </action>
  <verify>
npm run dist exits with code 0 (success).
dist/components/plus-page/plusPage.js exists and is recent.
No TypeScript errors in output.
  </verify>
  <done>
- TypeScript compilation succeeds
- No errors or warnings
- plusPage.js generated in dist/
- Plus Page module intact
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `grep -i "nativeplayer\|getNativePlayerContent\|setupNativePlayerControls" src/components/plus-page/plusPage.ts` returns no matches
- [ ] `npm run dist` succeeds without errors
- [ ] File size reduced by ~276 lines (from ~1500+ lines to ~1200+ lines)
- [ ] No TypeScript compilation errors
</verification>

<success_criteria>

- All 4 native player integration points removed from plusPage.ts (~276 lines total)
- TypeScript compilation succeeds without errors
- categoryContent object has 5 entries (themes, plugins, tweaks, appearance, about)
- Switch statement handles 5 categories
- No references to native player functions or category
- **Phase 3 complete** - UI cleanup finished, Plus Page fully cleaned
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-cleanup/03-02-SUMMARY.md`:

# Phase 3 Plan 2: Native Player Logic Removal Summary

**Removed native player TypeScript logic from Plus Page: ~276 lines deleted**

## Accomplishments

- Removed `nativeplayer: getNativePlayerContent,` from categoryContent object (line 20)
- Removed `case 'nativeplayer'` from switch statement (lines 322-324)
- Removed getNativePlayerContent() function (~181 lines including separator)
- Removed setupNativePlayerControls() function (~93 lines)
- Verified TypeScript compilation succeeds with 0 errors
- Plus Page now handles 5 categories (themes, plugins, tweaks, appearance, about)

## Files Created/Modified

- `src/components/plus-page/plusPage.ts` - Removed ~276 lines of native player logic

**Line reduction:**
- Before: ~1,500+ lines
- After: ~1,200+ lines
- Deleted: ~276 lines (18% reduction)

## Decisions Made

None - straightforward deletion as planned. All deletions matched investigation findings from Phase 1.

## Issues Encountered

None - TypeScript strict mode caught all issues during compilation verification. All integration points removed cleanly.

## Next Phase Readiness

**Phase 4: Dependencies & Configuration** - Ready to begin

**Next task:** Remove MPV-related dependencies from package.json and clean up STORAGE_KEYS constants that are now unused (will be removed in Phase 6 constants cleanup).

**Evidence of readiness:**
- Plus Page UI completely cleaned (HTML + TypeScript)
- No TypeScript errors
- App will compile and run (native player UI won't appear)
- Ready to clean up package.json and configuration files

**Phase 3 Status: COMPLETE** âœ“
- Plan 03-01: Native player sidebar item removed from HTML
- Plan 03-02: Native player logic removed from TypeScript
- Total UI integration points removed: HTML sidebar (6 lines) + TypeScript logic (~276 lines) = ~282 lines
</output>
